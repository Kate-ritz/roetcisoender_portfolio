---
title: "An exploration of fish communities in California MPAs"
format: html
execute:
  echo: false
  warning: false
  message: false
embed-resources: true
---

```{r}
library(mosaic)
library(tidyverse)
library(ggplot2)
library(ggridges)
```

### Data Description

These datasets are from a summer of data collected in 2023, with the purpose of assessing the possible impacts of marine protected areas (MPAs) on the fish communities they protect. That summer, the Lindholm lab and I completed four week long data collection trips at four different MPAs along California's central and north coast. We deployed stereo camera systems for 45 minutes each, then took that video back to the lab and spent the fall collecting fish data from it. Stereo video specifically uses two cameras to triangulate objects where the frames overlap, allowing us to measure fish down to the millimeter without ever touching them. These data were eventually processed and submitted to inform MPA management.

Here is the data: https://docs.google.com/spreadsheets/d/1KVd_7IsOHM9Xe1PDIf47Q4LnQt4J6QFjS5UL1i_GzpA/edit?gid=0#gid=0 

Sheets:

Drop_data - information on each camera system deployment

3D_points - Each individual fish counted

Lengths - The precise measurement of each fish able to be measured

### Data Cleaning

```{r}
drop <- read_csv("raw-data/drop.csv", col_types = list(Drop_ID = col_character()))
points <- read_csv("raw-data/points.csv", col_types = list(OpCode = col_character()))
lengths <- read_csv("raw-data/lengths.csv", col_types = list(OpCode = col_character()))

```

```{r}

points_clean <- points |> 
  select(OpCode, Common_name) |> 
  group_by(OpCode) |> 
  summarize(n_distinct(Common_name)) |> 
  left_join(drop, by = c("OpCode" = "Drop_ID")) |> 
  rename(Spp_richness = 'n_distinct(Common_name)') |> 
  mutate(Location = factor(Location, levels = c("Point_Buchon", "Point_Lobos", "Ano_Nuevo", "Montara")))

write_csv(points_clean, file = "clean-data/points-clean.csv")

```

```{r}
points_clean|> 
  ggplot(aes(x = Designation, 
             y = Spp_richness, 
             color = Location, 
             fill = Designation)) +
  geom_boxplot() +
  facet_grid(~ Location)+
  labs(x = "Species Richness", 
       y = "MPA Designation", 
       title = "Species richness is generally higher in MPAs than reference sites",
       alt = "There are four sets of two boxplots, from locations Point Buchon, Point Lobos, Ano Nuevo, and Montara. Each site has a boxplot for within the MPA and outside the MPA. The y-xis is species richness, which ranges from 0 to 12.5. The species richness appears higher in every MPA except Ano Nuevo") +
  scale_color_viridis_d(end = 0.7) +
  scale_fill_manual(values = c("lightgray", "darkgray")) +
  theme_minimal() +
  guides(fill = "none", 
         color = "none")
```

```{r}
lengths_clean <- lengths |> 
  select(Date, Location, Designation, `Length (mm)`, OpCode, Common_name) |>
  filter(Common_name != "Northern_Anchovy") |> 
  mutate(length_cm = `Length (mm)`/10) |> 
  mutate(Location = factor(Location, levels = c("Point_Buchon", "Point_Lobos", "Ano_Nuevo", "Montara"))) 

write_csv(lengths_clean, file = "clean-data/lengths-clean.csv")
```

```{r}
lengths_clean |>   
  ggplot() +
  geom_density_ridges(aes(x = length_cm, 
                          y = Location, 
                          color = Location), 
                      jittered_points = TRUE, 
                      alpha = 0.5) +
  labs(x = "Marine Protected Area Site",
       y = "Length (cm)",
       title = "Distributions of fish size by site",
       alt = "") +
  scale_color_viridis_d(end = 0.7) +
  guides(color = "none")
  
```
